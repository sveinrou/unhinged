{% extends "base.html" %}

{% block content %}
<div class="row">
  <div class="col">
    <h1> Trykk p√• den du liker best </h1>
    <a href="{% url 'profile_home' profile.id %}" class="btn btn-outline-secondary btn-sm mb-0">Tilbake til hjem</a>
  </div>
</div>
<div class="row mt-0 pt-0 flex-grow-1 d-flex flex-column justify-content-center">
  <div class="col-12 text-center">
    
    {% if error %}
    <div class="alert alert-warning">
        {{ error }}
    </div>
    {% else %}
    
    <div class="row align-items-center g-0 flex-grow-1 justify-content-center">
      <!-- Card 1 -->
      <div class="col-12 col-md-5 d-flex align-items-center justify-content-center clickable-card" onclick="document.getElementById('voteForm1').submit();">
        <div class="card h-100 shadow-sm hover-hover border border-rounded w-75 py-3">
          {% if card1.prompt %}
          <div class="card-header bg-transparent border-0 pt-1 pb-0">
            <h6 class="card-title">{{ card1.prompt.text }}</h6>
          </div>
          {% endif %}
          
          {% if card1.video %}
          <video controls preload="metadata" class="card-img-top img-fluid ranking-image d-block mx-auto">
              <source src="{{ card1.video.url }}" type="video/mp4">
              Your browser does not support the video tag.
          </video>
          {% elif card1.image %}
          <img src="{{ card1.image.url }}" class="card-img-top img-fluid ranking-image d-block mx-auto" alt="Card 1 Image">
          {% endif %}
          
          {% if card1.answer %} 
          <div class="card-body px-1 py-0 {% if card1.prompt %}pt-2{% endif %}">
            <p class="card-text fs-6 mb-1">{{ card1.answer }}</p>
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Card 2 -->
      <div class="col-12 col-md-5 d-flex align-items-center justify-content-center clickable-card" onclick="document.getElementById('voteForm2').submit();">
        <div class="card h-100 shadow-sm border border-rounded w-75 py-3">
          {% if card2.prompt %}
          <div class="card-header bg-transparent border-0 pt-1 pb-0">
            <h6 class="card-title">{{ card2.prompt.text }}</h6>
          </div>
          {% endif %}

           {% if card2.video %}
          <video controls preload="metadata" class="card-img-top img-fluid ranking-image d-block mx-auto">
              <source src="{{ card2.video.url }}" type="video/mp4">
              Your browser does not support the video tag.
          </video>
          {% elif card2.image %}
          <img src="{{ card2.image.url }}" class="card-img-top img-fluid ranking-image d-block mx-auto" alt="Card 2 Image">
          {% endif %}
          
          {% if card2.answer %} 
          <div class="card-body px-1 py-0 {% if card2.prompt %}pt-2{% endif %}">
            <p class="card-text fs-6 mb-1">{{ card2.answer }}</p>
          </div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Hidden forms for voting -->
    <form id="voteForm1" method="post" action="{% url 'rank_cards' profile.id card_type %}" style="display: none;">
        {% csrf_token %}
        <input type="hidden" name="winner" value="{{ card1.id }}">
        <input type="hidden" name="loser" value="{{ card2.id }}">
    </form>
    <form id="voteForm2" method="post" action="{% url 'rank_cards' profile.id card_type %}" style="display: none;">
        {% csrf_token %}
        <input type="hidden" name="winner" value="{{ card2.id }}">
        <input type="hidden" name="loser" value="{{ card1.id }}">
    </form>
    {% endif %}
  </div>
</div>
<style>
    /* Styling for form elements to match Bootstrap design */
    input[type="text"], textarea, select, input[type="file"] {
        width: 100%;
        padding: 0.375rem 0.75rem;
        font-size: 1rem;
        font-weight: 400;
        line-height: 1.5;
        color: #212529;
        background-color: #fff;
        background-clip: padding-box;
        border: 1px solid #ced4da;
        border-radius: 0.25rem;
        transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out;
    }
    input[type="checkbox"] {
        width: auto;
    }

    .ranking-image {
        max-height: 45vh; /* Max height 45% of viewport height */
        object-fit: contain;
        width: 100%; /* Ensure it takes full width of its container */
    }
    .clickable-card {
        cursor: pointer;
    }
    .clickable-card:hover .shadow-sm {
        box-shadow: 0 .5rem 1rem rgba(0,0,0,.15)!important; /* Re-apply hover shadow */
    }
    @media (max-width: 767.98px) { /* Adjust for smaller screens */
        .ranking-image {
            max-height: 30vh; /* Reduced from 35vh to 30vh for very small screens */
        }
    }
</style>
{% endblock %}

