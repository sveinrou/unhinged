{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-md-8">
    <div class="card mt-4">
      <div class="card-header">
        <h3>{{ title }}</h3>
      </div>
      <div class="card-body">
        <form method="post" enctype="multipart/form-data">
          {% csrf_token %}
          
          {% if form.non_field_errors %}
          <div class="alert alert-danger">
              {% for error in form.non_field_errors %}
                  {{ error }}
              {% endfor %}
          </div>
          {% endif %}

          {# Check if form has a 'prompt' field to determine if it's PromptCardForm #}
          {% if form.prompt %}
            <div class="mb-3">
                <label for="{{ form.prompt.id_for_label }}" class="form-label">{{ form.prompt.label }}</label>
                {{ form.prompt }}
                {% if form.prompt.errors %}
                <div class="text-danger">
                    {% for error in form.prompt.errors %}{{ error }}{% endfor %}
                </div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label class="form-label">Svartype</label>
                <div class="btn-group w-100" role="group" aria-label="Response Type">
                    <input type="radio" class="btn-check" name="response_type" id="type_text" autocomplete="off" checked onchange="toggleInputs('prompt')">
                    <label class="btn btn-outline-primary" for="type_text">Tekst</label>
                  
                    <input type="radio" class="btn-check" name="response_type" id="type_image" autocomplete="off" onchange="toggleInputs('prompt')">
                    <label class="btn btn-outline-primary" for="type_image">Bilde</label>

                    <input type="radio" class="btn-check" name="response_type" id="type_video" autocomplete="off" onchange="toggleInputs('prompt')">
                    <label class="btn btn-outline-primary" for="type_video">Video</label>
                </div>
            </div>

            <div class="mb-3" id="text_input_container">
                <label for="{{ form.answer.id_for_label }}" class="form-label">{{ form.answer.label }}</label>
                {{ form.answer }}
                {% if form.answer.errors %}
                <div class="text-danger">
                    {% for error in form.answer.errors %}{{ error }}{% endfor %}
                </div>
                {% endif %}
            </div>

            <div class="mb-3 d-none" id="image_input_container">
                <label for="{{ form.image.id_for_label }}" class="form-label">{{ form.image.label }}</label>
                {{ form.image }}
                {% if form.image.errors %}
                <div class="text-danger">
                    {% for error in form.image.errors %}{{ error }}{% endfor %}
                </div>
                {% endif %}
            </div>

            <div class="mb-3 d-none" id="video_input_container">
                <label for="{{ form.video.id_for_label }}" class="form-label">{{ form.video.label }}</label>
                {{ form.video }}
                {% if form.video.errors %}
                <div class="text-danger">
                    {% for error in form.video.errors %}{{ error }}{% endfor %}
                </div>
                {% endif %}
            </div>

          {% else %} {# For MediaCardForm #}
            <div class="mb-3">
                <label class="form-label">Medietype</label>
                <div class="btn-group w-100" role="group" aria-label="Media Type">
                    <input type="radio" class="btn-check" name="media_type" id="media_image" autocomplete="off" checked onchange="toggleInputs('media')">
                    <label class="btn btn-outline-primary" for="media_image">Bilde</label>
                  
                    <input type="radio" class="btn-check" name="media_type" id="media_video" autocomplete="off" onchange="toggleInputs('media')">
                    <label class="btn btn-outline-primary" for="media_video">Video</label>
                </div>
            </div>

            <div class="mb-3" id="media_image_input_container">
                <label for="{{ form.image.id_for_label }}" class="form-label">{{ form.image.label }}</label>
                {{ form.image }}
                {% if form.image.errors %}
                <div class="text-danger">
                    {% for error in form.image.errors %}{{ error }}{% endfor %}
                </div>
                {% endif %}
            </div>

            <div class="mb-3 d-none" id="media_video_input_container">
                <label for="{{ form.video.id_for_label }}" class="form-label">{{ form.video.label }}</label>
                {{ form.video }}
                {% if form.video.errors %}
                <div class="text-danger">
                    {% for error in form.video.errors %}{{ error }}{% endfor %}
                </div>
                {% endif %}
            </div>

          {% endif %}
          
          <button type="submit" class="btn btn-success mt-3">Send inn</button>
          <a href="{% url 'profile_home' profile.id %}" class="btn btn-secondary mt-3">Avbryt</a>
        </form>
      </div>
    </div>
  </div>
</div>

<style>
    /* Simple styling to make form fields look decent with bootstrap classes added via JS or just defaults */
    input[type="text"], textarea, select, input[type="file"] {
        width: 100%;
        padding: 0.375rem 0.75rem;
        font-size: 1rem;
        font-weight: 400;
        line-height: 1.5;
        color: #212529;
        background-color: #fff;
        background-clip: padding-box;
        border: 1px solid #ced4da;
        border-radius: 0.25rem;
        transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out;
    }
    input[type="checkbox"] {
        width: auto;
    }
    .d-none {
        display: none !important;
    }
</style>

<script>
    function toggleInputs(formType) {
        if (formType === 'prompt') {
            const textRadio = document.getElementById('type_text');
            const imageRadio = document.getElementById('type_image');
            const videoRadio = document.getElementById('type_video');

            const textContainer = document.getElementById('text_input_container');
            const imageContainer = document.getElementById('image_input_container');
            const videoContainer = document.getElementById('video_input_container');

            const textInput = document.querySelector('#text_input_container [name="answer"]');
            const imageInput = document.querySelector('#image_input_container [name="image"]');
            const videoInput = document.querySelector('#video_input_container [name="video"]');

            // Hide all and clear values
            textContainer.classList.add('d-none');
            imageContainer.classList.add('d-none');
            videoContainer.classList.add('d-none');
            if(textInput) textInput.value = '';
            if(imageInput) imageInput.value = '';
            if(videoInput) videoInput.value = '';

            if (textRadio.checked) {
                textContainer.classList.remove('d-none');
            } else if (imageRadio.checked) {
                imageContainer.classList.remove('d-none');
            } else if (videoRadio.checked) {
                videoContainer.classList.remove('d-none');
            }
        } else if (formType === 'media') {
            const imageMediaRadio = document.getElementById('media_image');
            const videoMediaRadio = document.getElementById('media_video');

            const imageMediaContainer = document.getElementById('media_image_input_container');
            const videoMediaContainer = document.getElementById('media_video_input_container');

            const imageInput = document.querySelector('#media_image_input_container [name="image"]');
            const videoInput = document.querySelector('#media_video_input_container [name="video"]');

            // Hide all and clear values
            imageMediaContainer.classList.add('d-none');
            videoMediaContainer.classList.add('d-none');
            if(imageInput) imageInput.value = '';
            if(videoInput) videoInput.value = '';

            if (imageMediaRadio.checked) {
                imageMediaContainer.classList.remove('d-none');
            } else if (videoMediaRadio.checked) {
                videoMediaContainer.classList.remove('d-none');
            }
        }
    }
    document.addEventListener('DOMContentLoaded', () => {
        // Initialize based on which form is present
        if (document.getElementById('type_text')) {
            toggleInputs('prompt');
        } else if (document.getElementById('media_image')) {
            toggleInputs('media');
        }
    });
</script>
{% endblock %}
