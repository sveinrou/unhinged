{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-md-8">
    <div class="card mt-4">
      <div class="card-header">
        <h3>{{ title }}</h3>
      </div>
      <div class="card-body">
        <form method="post" enctype="multipart/form-data">
          {% csrf_token %}
          
          {% if form.non_field_errors %}
          <div class="alert alert-danger">
              {% for error in form.non_field_errors %}
                  {{ error }}
              {% endfor %}
          </div>
          {% endif %}

          {# Render specific fields manually if it's the PromptCardForm to control layout #}
          {% if form.prompt %}
            <div class="mb-3">
                <label for="{{ form.prompt.id_for_label }}" class="form-label">{{ form.prompt.label }}</label>
                {{ form.prompt }}
                {% if form.prompt.errors %}
                <div class="text-danger">
                    {% for error in form.prompt.errors %}{{ error }}{% endfor %}
                </div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label class="form-label">Response Type</label>
                <div class="btn-group w-100" role="group" aria-label="Response Type">
                    <input type="radio" class="btn-check" name="response_type" id="type_text" autocomplete="off" checked onchange="toggleInputs()">
                    <label class="btn btn-outline-primary" for="type_text">Text</label>
                  
                    <input type="radio" class="btn-check" name="response_type" id="type_image" autocomplete="off" onchange="toggleInputs()">
                    <label class="btn btn-outline-primary" for="type_image">Image</label>
                </div>
            </div>

            <div class="mb-3" id="text_input_container">
                <label for="{{ form.answer.id_for_label }}" class="form-label">{{ form.answer.label }}</label>
                {{ form.answer }}
                {% if form.answer.errors %}
                <div class="text-danger">
                    {% for error in form.answer.errors %}{{ error }}{% endfor %}
                </div>
                {% endif %}
            </div>

            <div class="mb-3 d-none" id="image_input_container">
                <label for="{{ form.image.id_for_label }}" class="form-label">{{ form.image.label }}</label>
                {{ form.image }}
                {% if form.image.errors %}
                <div class="text-danger">
                    {% for error in form.image.errors %}{{ error }}{% endfor %}
                </div>
                {% endif %}
            </div>

          {% else %}
             {# Default rendering for ImageCardForm #}
              {% for field in form %}
              <div class="mb-3">
                <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                {{ field }}
                {% if field.help_text %}
                <div class="form-text">{{ field.help_text }}</div>
                {% endif %}
                {% if field.errors %}
                <div class="text-danger">
                    {% for error in field.errors %}
                        {{ error }}
                    {% endfor %}
                </div>
                {% endif %}
              </div>
              {% endfor %}
          {% endif %}
          
          <button type="submit" class="btn btn-success mt-3">Submit</button>
          <a href="{% url 'profile_home' profile.id %}" class="btn btn-secondary mt-3">Cancel</a>
        </form>
      </div>
    </div>
  </div>
</div>

<style>
    /* Simple styling to make form fields look decent with bootstrap classes added via JS or just defaults */
    input[type="text"], textarea, select, input[type="file"] {
        width: 100%;
        padding: 0.375rem 0.75rem;
        font-size: 1rem;
        font-weight: 400;
        line-height: 1.5;
        color: #212529;
        background-color: #fff;
        background-clip: padding-box;
        border: 1px solid #ced4da;
        border-radius: 0.25rem;
        transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out;
    }
    input[type="checkbox"] {
        width: auto;
    }
    .d-none {
        display: none !important;
    }
</style>

<script>
    function toggleInputs() {
        const textRadio = document.getElementById('type_text');
        const textContainer = document.getElementById('text_input_container');
        const imageContainer = document.getElementById('image_input_container');
        const textInput = document.querySelector('[name="answer"]');
        const imageInput = document.querySelector('[name="image"]');

        if (textRadio.checked) {
            textContainer.classList.remove('d-none');
            imageContainer.classList.add('d-none');
            // Clear image input
            if(imageInput) imageInput.value = '';
        } else {
            textContainer.classList.add('d-none');
            imageContainer.classList.remove('d-none');
            // Clear text input
            if(textInput) textInput.value = '';
        }
    }
</script>
{% endblock %}
